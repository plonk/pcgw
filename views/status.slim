- content_for :title do
  | ãƒãƒ£ãƒ³ãƒãƒ« / #{@info['info']['name']}

script src="/reloader.js"

.panel
  h4 style="display: inline"
    = @info['info']['name']
    == erb :tweet_button, locals: { link_url: @link_url, data_text: @data_text }
    .btn-group style="vertical-align: top;"
      button.btn.btn-sm.btn-secondary.dropdown-toggle type="button" data-toggle="dropdown" aria-expanded="false" title="æ›´æ–°ã®é–“éš”"
        span#refresh-interval âˆ
        | ç§’
        span.caret style="margin-left: 0.5em"
      .dropdown-menu[role="menu"]
        a.dropdown-item href="#" onclick="changeInterval(1)"
          | 1ç§’
        a.dropdown-item href="#" onclick="changeInterval(3)"
          | 3ç§’
        a.dropdown-item href="#" onclick="changeInterval(5)"
          | 5ç§’
        a.dropdown-item href="#" onclick="changeInterval(10)"
          | 10ç§’

  p#error style="color: red"

  .alert.alert-warning#warning style="display: none"

  .table-responsive
    table.table.head-keep
      tr
        th ãƒ¡ãƒ‡ã‚£ã‚¢â€‰URL
        td
          code#source.url.text-info
            = @channel.push_uri
      - if @channel.stream_key
        tr
          th ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚­ãƒ¼
          td.form-inline
            input#streamKey.form-control type="password" value=@channel.stream_key readonly=true
            | &thinsp;
            | ğŸ‘ï¸
            input#revealCheckbox type="checkbox"
      tr
        th é…ä¿¡ã‚µãƒ¼ãƒãƒ¼
        td
          = @channel.servent.name
          span.text-muted
            |  #{@channel.servent.hostname}:#{@channel.servent.port}
      tr
        th
          | åŒæ™‚é…ä¿¡
          sup
            a href="/doc/repeaters"
              | ?
        td
          span#repeater_status
            = @repeater_status
          | &nbsp;
          - if @channel.channel_info.stream_type == "FLV"
            a.btn.btn-secondary.btn-sm href="/channels/#{@channel.id}/create_repeater"
              | å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡...
            | &nbsp;
            a.btn.btn-warning.btn-sm href="/channels/#{@channel.id}/stop_repeater"
              | åœæ­¢
          - else
            a.btn.btn-secondary.btn-sm href="/channels/#{@channel.id}/create_repeater" disabled=true
              | å¤–éƒ¨ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡...
            | &nbsp;
            a.btn.btn-warning.btn-sm href="/channels/#{@channel.id}/stop_repeater" disabled=true
              | åœæ­¢
      tr
        th ç¨¼å‹•æ™‚é–“
        td
          span#uptime
            = TimeUtil.render_duration @status['uptime']
      tr
        th æ¥ç¶šçŠ¶æ…‹
        td
          span#status style="margin-right: 0.5em" class=@status_class
            = @status['status']
          - if @channel.servent.can_restart_channel_connection?
            a.btn.btn-secondary.btn-sm style="margin-left: 0.5em; margin-right: 0.5em" href="/channels/#{@channel.id}/reset" title="ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã¨ã®ç¾åœ¨ã®æ¥ç¶šã‚’ç ´æ£„ã—ã€å¾…ã¡å—ã‘çŠ¶æ…‹ã«æˆ»ã—ã¾ã™(FLV ã®å ´åˆ)ã€‚"
              |  ãƒªã‚»ãƒƒãƒˆ
          div style="display: inline-block; height: 1em; line-height: 1.0em; text-align: center; vertical-align: middle; transform: translate(0px, -30px)"
            div.text-muted style="font-size: 10px; transform: translate(0px, 17px)" â–¼
            br
            meter#bitrate_meter value="#{'%.2f' % @bitrate_meter}" max="1.0" min="0.0" low="0.25" high="0.75" optimum="0.5"
          span#source_rate style="margin-left: 0.5em"
            = @source_kbps
          | Kbps
      tr
        th å…¬ç§°ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ
        td
          span#bitrate
            = @info['info']['bitrate']
          | Kbps
      tr
        th ãƒªã‚¹ãƒŠãƒ¼/ãƒªãƒ¬ãƒ¼
        td
          span#direct
            = @status['totalDirects']
          |  /&nbsp;
          span#relay
            = @status['totalRelays']
          - if @channel.servent.can_get_relay_tree?
            | &nbsp;
            a.btn.btn-secondary.btn-sm href="/channels/#{@channel.id}/relay_tree" target="_blank"
              | ãƒªãƒ¬ãƒ¼ãƒ„ãƒªãƒ¼
      tr
        th ç›´ä¸‹æ¥ç¶š
        td
          #connections
            == @connections
      tr
        th ã‚¸ãƒ£ãƒ³ãƒ«
        td #{@info['info']['genre']}
      tr
        th è©³ç´°
        td #{@info['info']['desc']}
      tr
        th ã‚³ãƒ¡ãƒ³ãƒˆ
        td #{@info['info']['comment']}
      tr
        th ã‚³ãƒ³ã‚¿ã‚¯ãƒˆâ€‰URL
        td
          a target="_blank" href=@info['info']['url'] #{@info['info']['url']}
          | &thinsp;
          a.btn.btn-secondary.btn-sm href="/channels/#{@channel.id}/thread_list"
            |  ä¸€è¦§
      tr
        th æ²è¼‰YP
        td
          == slim :yellow_page_links, locals: { yp_names: [@channel.channel_info.yp] }

  div
    form action="/channels/#{@channel.id}/stop" method="POST" role="form"
      div.btn-group.btn-group-justified role="group"
        .btn-group
          button.btn.btn-warning type="submit" é…ä¿¡åœæ­¢
        .btn-group
          a.btn.btn-secondary href="/channels/#{@channel.id}/edit" è©³ç´°å¤‰æ›´
        / .btn-group
        /   a.btn.btn-secondary href="/channels/#{@channel.id}/play" target="_blank"
        /     |  å†ç”Ÿ

javascript:
  $('#revealCheckbox').on('click', function(){
    if (this.checked) {
      $('#streamKey')[0].type = "text";
    } else {
      $('#streamKey')[0].type = "password";
    }
  });

  var g_interval;
  function changeInterval(int) {
    g_interval = int;
    $("#refresh-interval").text(int);
  }
- unless @testing
 javascript:
  $(function() {
    var timeoutSec = 10;
    changeInterval(5); // Peercast ã®ãƒ‡ãƒ¼ã‚¿ãƒ¬ãƒ¼ãƒˆæ›´æ–°ãŒ5ç§’ã”ã¨ãªã®ã§5
                       // ç§’ãŒè‰¯ã„ã¨æ€ã†ã€‚
    var recur = function() {
      $.ajax({
        url: '/channels/#{@channel.id}/update',
        dataType: "script",
        success: function (script, textStatus, jqxhr) {
          $('table').fadeTo(0, 1.0);
          $('#warning').hide();
          setTimeout(recur, g_interval * 1000);
        },
        error: function (jqxhr, textStatus, exception) {
          $('table').fadeTo(1000, 0.5);
          $('#warning').text("ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰"+timeoutSec+"ç§’é–“å¿œç­”ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚").fadeTo(1000, 1.0);
          setTimeout(recur, g_interval * 1000);
        },
        timeout: timeoutSec * 1000,
      });
    };
    setTimeout(recur, g_interval * 1000);
  });
